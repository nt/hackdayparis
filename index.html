<!html>
<head>
  
  <script src="/socket.io/socket.io.js"></script>
  <script type="text/javascript" src="js/jquery.js"></script>
  <script type="text/javascript" src="js/raphael-min.js"></script>
  <script type="text/javascript" src="js/json2.js"></script>
  <script type="text/javascript" src="js/raphael.sketchpad.js"></script>
  <script type="text/javascript" src="js/jscolor/jscolor.js"></script>
  <script type="text/javascript" src="js/farbtastic/farbtastic.js"></script>
  <link rel="stylesheet" href="js/farbtastic/farbtastic.css" type="text/css" />
  
</head>
<body>
  <style>
  
    #colorpicker{
      display: inline-block;
    }
  
  </style>
  <div id="editor" class="sketchpad"></div>
  <div id="colorpicker"></div>
  <div id="news" style=""></div>
  
  <script type="text/javascript">
  	
  	$(function(){
  	  
  	  // Connect to drawing server
  	  var socket = io.connect('http://localhost');
      
      // Create the editor sketchpad
    	var sketchpad = Raphael.sketchpad("editor", {
    		width: 400,
    		height: 400,
    		editing: true
    	});
    	
    	var pen = sketchpad.pen();
      
      // Create the viewer sketchpad
      // var sketchpad2 = Raphael.sketchpad("viewer", {
      //  width: 200,
      //  height: 400,
      //  editing: false
      // });

      // Listen to news
      socket.on('news', function(data) {
        
        // Add the message to the top of the news bar
        if(data){
          $('#news').prepend(data + "<br />");
        }
        
      });


      var listenToChanges = true;
      
    	// When the server sends me a drawing, draw it in the sketchpad
      socket.on('draw', function (data) {
        
        listenToChanges = false;
        sketchpad.strokes(data.strokes);
        
      });

    	// When the sketchpad changes, send the drawing to the server
    	sketchpad.change(function() {
        
        if(listenToChanges){
         socket.emit("drawThis",{ strokes: sketchpad.strokes()}); 
        }
    	  else{
    	    listenToChanges = true;
    	  }

    	});
    	
    	
    	// Set styles
    	var sketchpads = $('.sketchpad');
    	sketchpads.css('display', 'inline-block');
    	sketchpads.css('margin','10px');
    	sketchpads.css('border','black 2px solid');
    	sketchpads.height(400);
    	sketchpads.width(400);
    	
    	// add colors
    	$('#colorpicker').farbtastic(sketchpad.pen().color);
    	
    	
    	
  	});
  </script>

</body>